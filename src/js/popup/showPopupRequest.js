/* @flow */
'use strict';

const layerID: string = 'TrezorConnectInteractionLayer';

const layerInnerHtml: string = `
    <div class="trezorconnect-container" id="${layerID}">
        <div class="trezorconnect-window">
            <div class="trezorconnect-head">
                <svg width="78px" height="20px" viewBox="0 0 63 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <g stroke="none" stroke-width="1" fill="none" transform="translate(-537.000000, -874.000000)">
                        <path d="M552.459206,878.900031 L559.367802,878.900031 L559.367802,880.902943 L557.029925,880.902943 L557.029925,887.434943 L554.809687,887.434943 L554.809687,880.902943 L552.459206,880.902943 L552.459206,878.900031 Z M567.325636,881.739209 C567.325636,883.15431 566.504457,883.955628 565.692063,884.268821 L567.561295,887.434752 L565.014877,887.434752 L563.436304,884.554515 L562.578458,884.554515 L562.578458,887.434752 L560.369678,887.434752 L560.369678,878.899458 L564.378559,878.899458 C566.141992,878.899458 567.325636,880.040706 567.325636,881.739209 Z M562.578458,880.866468 L562.578458,882.587506 L564.125712,882.587506 C564.697864,882.587506 565.082863,882.241465 565.082863,881.726605 C565.082863,881.212509 564.697864,880.866468 564.125712,880.866468 L562.578458,880.866468 Z M568.349015,887.434828 L568.349015,878.899916 L574.534592,878.899916 L574.534592,880.866544 L570.557031,880.866544 L570.557031,882.117409 L574.450565,882.117409 L574.450565,884.084037 L570.557031,884.084037 L570.557031,885.455597 L574.534592,885.455597 L574.534592,887.434828 L568.349015,887.434828 Z M582.162388,880.603118 L578.608403,885.432031 L582.162388,885.432031 L582.162388,887.434943 L575.627715,887.434943 L575.627715,885.719252 L579.180554,880.902179 L575.627715,880.902179 L575.627715,878.900031 L582.162388,878.900031 L582.162388,880.603118 Z M586.960555,878.766465 C589.54173,878.766465 591.414781,880.62042 591.414781,883.172949 C591.414781,885.726624 589.54173,887.579432 586.960555,887.579432 C584.386255,887.579432 582.518169,885.726624 582.518169,883.172949 C582.518169,880.62042 584.386255,878.766465 586.960555,878.766465 Z M586.960555,885.563916 C588.254962,885.563916 589.159022,884.580793 589.159022,883.172949 C589.159022,881.765487 588.254962,880.781982 586.960555,880.781982 C585.65278,880.781982 584.773928,881.742952 584.773928,883.172949 C584.773928,884.580793 585.673023,885.563916 586.960555,885.563916 Z M597.640691,884.268821 L599.510305,887.434752 L596.964269,887.434752 L595.385696,884.554515 L594.527087,884.554515 L594.527087,887.434752 L592.319071,887.434752 L592.319071,878.899458 L596.327951,878.899458 C598.091385,878.899458 599.276174,880.040706 599.276174,881.739209 C599.276174,883.15431 598.453849,883.955628 597.640691,884.268821 Z M594.527087,880.866468 L594.527087,882.587506 L596.075104,882.587506 C596.647256,882.587506 597.032255,882.241465 597.032255,881.726605 C597.032255,881.212509 596.647256,880.866468 596.075104,880.866468 L594.527087,880.866468 Z M546.397723,878.915232 L548.007997,878.915232 L548.007997,887.433339 L547.996921,887.433339 L542.504189,890 L537.011076,887.433339 L537,887.433339 L537,878.915232 L538.611038,878.915232 L538.611038,877.719367 C538.611038,875.668712 540.358048,874 542.504953,874 C544.650713,874 546.397723,875.668712 546.397723,877.719367 L546.397723,878.915232 Z M545.792724,886.01671 L545.792724,880.913943 L539.215273,880.913943 L539.215273,886.01671 L542.504189,887.549832 L545.792724,886.01671 Z M540.608221,877.719367 L540.608221,878.915232 L544.400539,878.915232 L544.400539,877.719367 C544.400539,876.770237 543.549569,875.997947 542.504953,875.997947 C541.459192,875.997947 540.608221,876.770237 540.608221,877.719367 Z" id="Logotype" fill="#000000"></path>
                    </g>
                </svg>

            </div>
            <div class="trezorconnect-body">
                <h2>Popup was blocked</h2>
                <p>Please click to “Continue” to open popup manually</p>
                <button class="trezorconnect-open">Continue</button>
            </div>
        </div>
    </div>
`;

export const showPopupRequest = (open: () => void, cancel: () => void) => {
    if (document.getElementById(layerID)) {
        return;
    }

    const div: HTMLDivElement = document.createElement('div');
    div.id = layerID;
    div.className = 'trezorconnect-container';
    div.innerHTML = layerInnerHtml;

    if (document.body) {
        document.body.appendChild(div);
    }

    let button: HTMLElement = div.getElementsByClassName('trezorconnect-open')[0];
    button.onclick = () => {
        open();
        if (document.body) { document.body.removeChild(div); }
    };

    // button = div.getElementsByClassName('cancel')[0];
    // button.onclick = () => {
    //     cancel();
    //     if (document.body) { document.body.removeChild(div); }
    // };
};

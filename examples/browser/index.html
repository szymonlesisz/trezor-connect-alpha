<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>TREZOR Connect 2.0</title>
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta name="author" content="TREZOR info@trezor.io" />
    <meta name="robots" content="index, follow" />
    <meta name="title" content="TREZOR Connect" />
    <meta name="theme-color" content="#ffffff" />
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Verdana';
            font-size: 12px;
        }

        .container {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            position: relative;
            width: 100%;
        }
        .container h3 {
            display: inline-block;
            width: 100%;
            padding: 0px 10px;
        }
        .menu {
            display: inline-block;
            vertical-align: top;

        }
        .menu-table {
            display: table;
            border-right: 1px solid #666666;
        }
        .menu-column {
            display: table-column;
        }
        .menu-row {
            display: table-row;
        }
        .menu-row div {
            display: table-cell;
            padding: 10px;
            border-left: 1px solid #666666;
            border-bottom: 1px solid #666666;
        }
        .menu-cell {
            background: #666666;
            color: #ffffff;
            text-transform: uppercase;
            text-align: center;
        }
        #response {
            display: inline-block;

            flex: 1;
            padding: 0px 10px;
            word-wrap: break-word;
            word-break: break-all;
        }
        .json-key { color: brown; }
        .json-value { color: navy; }
        .json-string { color: green; }
    </style>
</head>
<body>
    <div class="container">
        <h3>TrezorConnect 2.0 methods</h3>
        <div class="menu">
            <div class="menu-table">
                <div class="menu-column"></div>
                <div class="menu-column"></div>
                <div class="menu-row">
                    <div class="menu-cell">
                        Modal
                    </div>
                    <div class="menu-cell">
                        Popup
                    </div>
                </div>

                <div class="menu-row">
                    <div>
                        <button id="getXPubKey-modal">Get XPub key</button>
                    </div>
                    <div>
                        <button id="getXPubKey-popup">Get XPub key</button>
                    </div>
                </div>


                <div class="menu-row">
                    <div>
                        <button id="getCypherKeyValue-modal">Get Cypher Key value</button>
                    </div>
                    <div>
                        <button id="getCypherKeyValue-popup">Get Cypher Key value</button>
                    </div>
                </div>
                <div class="menu-row">
                    <div>
                        <button id="getAccountInfo-modal">Get account info</button>
                    </div>
                    <div>
                        <button id="getAccountInfo-popup">Get account info</button>
                    </div>
                </div>
                <div class="menu-row">
                    <div>
                        <button id="requestLogin-modal">Request login</button>
                    </div>
                    <div>
                        <button id="requestLogin-popup">Request login</button>
                    </div>
                </div>
                <div class="menu-row">
                    <div>
                        <button id="signMessage-modal">Sign message</button>
                    </div>
                    <div>
                        <button id="signMessage-popup">Sign message</button>
                    </div>
                </div>
                <div class="menu-row">
                    <div>
                        <button id="verifyMessage-modal">Verify message</button>
                    </div>
                    <div>
                        <button id="verifyMessage-popup">Verify message</button>
                    </div>
                </div>


            </div>
        </div>
        <div id="response"></div>
    </div>

    <!-- Trezor popup container -->
    <div id="trezor-connect"></div>
    <!-- TrezorConnect script -->
    <script type="text/javascript" src="/trezor-connect.js"></script>

    <!-- implementation -->
    <script type="text/javascript">
    (function() {

        var buttons = document.querySelectorAll('button');
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].addEventListener('click', handleButtonClick);
        }

        var logo = 'https://aurumpay.com/assets/img/logo.png';
        var resp = document.getElementById('response');

        function handleResponse(response){
            if(response === undefined){
                console.error("Undefined response");
                return;
            }
            resp.innerHTML = jsonPrettyPrint.toHtml(response);
            console.log(response);
        }

        function handleButtonClick(event){

            var buttonId = event.currentTarget.id.split('-');
            var method = buttonId[0];
            var containerType = buttonId[1]; // popup || modal
            var description = "m/44'/0'/0'";
            var firmware = "1.3.4";

            switch (method) {

                case 'requestLogin':
                    TrezorConnect.requestLogin({
                        container: containerType,
                        icon: logo,
                        challengeVisual: 'Login to website.com?',
                        challengeHidden: '',
                        requiredFirmware: firmware
                    }).then(handleResponse);
                break;

                case 'signMessage':
                    TrezorConnect.signMessage({
                        container: containerType,
                        icon: logo,
                        description: description,
                        message: 'My message',
                        coin: 'Litecoin',
                        requiredFirmware: firmware
                    }).then(handleResponse);
                break;

                case 'verifyMessage':
                    TrezorConnect.verifyMessage({
                        container: containerType,
                        icon: logo,
                        address: '12HMGfwtqjBw1oweX89vEzwwCgP78piz4p',
                        signature: 'H5yppt5iSLDW/li5HlI5KkgjCseMbpcgGQmj4GeQrRiBSGmorgeYHDrsevm3AWzXJt2MWKvNkJIz7aaUgCiUXXg=',
                        message: 'My message',
                        coin: 'Bitcoin',
                        requiredFirmware: firmware
                    }).then(handleResponse);
                break;

                case 'getCypherKeyValue':
                    TrezorConnect.getCypherKeyValue({
                        container: containerType,
                        path: "m/10016'/0",
                        key: 'Unlock encrypted storage?',
                        value: '2d650551248d792eabf628f451200d7f51cb63e46aadcbb1038aacb05e8c8aee2d650551248d792eabf628f451200d7f51cb63e46aadcbb1038aacb05e8c8aee',
                        encrypt: true,
                        confirmEncrypt: true,
                        confirmDecrypt: true,
                        requiredFirmware: firmware
                    }).then(handleResponse);
                break;

                case 'getXPubKey':
                    TrezorConnect.getXPubKey({
                        container: containerType,
                        icon: logo,
                        description: description,
                        confirm: false,
                        accountDiscovery: true,
                        requiredFirmware: firmware
                    }).then(handleResponse);
                break;

                case 'getAccountInfo':
                    TrezorConnect.getAccountInfo({
                        container: containerType,
                        icon: logo,
                        description: description,
                        coin: 'Bitcoin',
                        requiredFirmware: firmware
                    }).then(handleResponse);
                break;

                case 'getFreshAddress':
                case 'getBalance':
                case 'getAddress':
                case 'signTx':
                case 'signEthTx':
                case 'composeAndSignTx':
                case 'pushTransaction':
                break;


            }
        }

        var jsonPrettyPrint = {
            replacer: function(match, pIndent, pKey, pVal, pEnd) {
                var key = '<span class=json-key>';
                var val = '<span class=json-value>';
                var str = '<span class=json-string>';
                var r = pIndent || '';
                if (pKey)
                    r = r + key + pKey.replace(/[": ]/g, '') + '</span>: ';
                if (pVal)
                    r = r + (pVal[0] == '"' ? str : val) + pVal + '</span>';
                return r + (pEnd || '');
            },
            toHtml: function(obj) {
                var jsonLine = /^( *)("[\w]+": )?("[^"]*"|[\w.+-]*)?([,[{])?$/mg;
                return JSON.stringify(obj, null, 3)
                    .replace(/&/g, '&amp;').replace(/\\"/g, '&quot;')
                    .replace(/</g, '&lt;').replace(/>/g, '&gt;')
                    .replace(jsonLine, jsonPrettyPrint.replacer);
            }
        };

    })();


</script>

<iframe src="http://localhost:8081/tunnel.html"></iframe>

</body>
</html>
